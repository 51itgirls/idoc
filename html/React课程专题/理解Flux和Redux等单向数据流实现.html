<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>YOFFE</title>
        
    <link rel="stylesheet" type="text/css" href="../../static/css/main.css">
</head>
<body>
<div class="navbar navbar-line">
    <div class="container">
        <div class="logo">
            
                YOFFE
            
        </div>
        <input type="checkbox" id="idoc_nav" />
        <div class="menu_tree">
        <ul><li><a href="../../index.html">首页</a></li><li><a href="#"><span></span>React课程专题</a><ul><li><a href="../../index.html">React学习指南</a></li><li><a href="../../index.html">搭建基本环境</a></li><li><a href="../../index.html">增强Webpack配置</a></li><li><a href="../../index.html">ES6语法快餐</a></li><li><a href="../../index.html">React技术分享</a></li><li><a href="../../index.html">React编码规范</a></li><li><a href="../../index.html">Webpack配置详细指南</a></li><li><a href="../../index.html">React基础知识详解</a></li><li><a href="../../index.html">一步步搭建一个评论应用</a></li><li><a href="../../index.html">github-notetaker应用开发</a></li><li><a href="../../index.html">React-AJAX的最佳实践</a></li><li><a href="../../index.html">React-router路由实践</a></li><li><a href="../../index.html">理解Flux和Redux等单向数据流实现</a></li></ul></li><li><a href="#"><span></span>前沿观察</a><ul><li><a href="../../index.html">ECMAScript 6入门</a></li><li><a href="../../index.html">Immutable详解及React中实践</a></li><li><a href="../../index.html">Node.js MVC框架ThinkJS</a></li><li><a href="../../index.html">Nodejs 5.0.0版本</a></li><li><a href="../../index.html">关系型数据库PostgreSQL</a></li><li><a href="../../index.html">轻型MVVM框架Vue.js</a></li><li><a href="../../index.html">基于nodejs的开发框架koa</a></li></ul></li><li><a href="#"><span></span>前端工程化</a><ul><li><a href="../../index.html">前端模板</a></li><li><a href="../../index.html">性能优化和前端工程的爱恨情仇</a></li><li><a href="../../index.html">webpack入门及实践</a></li><li><a href="../../index.html">前端工程化不完全装逼指南</a></li></ul></li><li><a href="#"><span></span>性能优化</a><ul><li><a href="../../index.html">jshint代码质量检测</a></li><li><a href="../../index.html">jshint配置说明</a></li><li><a href="../../index.html">NC性能优化</a></li><li><a href="../../index.html">性能优化待办事项</a></li><li><a href="../../index.html">性能优化点总结</a></li></ul></li><li><a href="#"><span></span>技术分享</a><ul><li><a href="../../index.html">学习Git</a></li><li><a href="../../index.html">面向对象</a></li><li><a href="../../index.html">Node.js知识详解</a></li><li><a href="../../index.html">2015年大前端技术年终总结</a></li><li><a href="../../index.html">Nodejs环境配置和Git基本配置</a></li></ul></li><li><a href="#"><span></span>团队</a><ul><li><a href="../../index.html">新员工入职指南</a></li><li><a href="../../index.html">笔试面试大纲</a></li><li><a href="../../index.html">项目技术栈规划</a></li></ul></li><li><a href="../../index.html">CONTACT</a></li></ul>    
        </div>
        
        
        <div class="forkgithub"><a target="_blank" href="https://github.com/GuoYongfeng">fork on github</a></div>
        

        <section class="idoc_nav_btn">
            <label for="idoc_nav"><span></span></label>
        </section>
    </div>
    
</div>




<div class="container">

    <div class="page-toc">
        <ul><li><a href="#t0理解Redux单向数据流实现">理解Redux单向数据流实现</a><ul><li><a href="#t11.simple-action-creator">1.simple-action-creator</a></li><li><a href="#t22.about-state-and-meet-redux">2.about-state-and-meet-redux</a></li><li><a href="#t33.simple-reducer">3.simple-reducer</a></li><li><a href="#t44.get-state">4.get-state</a></li><li><a href="#t55.combine-reducers">5.combine-reducers</a></li><li><a href="#t66.dispatch-action">6.dispatch-action</a></li><li><a href="#t77.dispatch-async-action-1.js">7.dispatch-async-action-1.js</a></li><li><a href="#t88.dispatch-async-action-2">8.dispatch-async-action-2</a></li><li><a href="#t99.middleware">9.middleware</a></li><li><a href="#t1010.state-subscriber">10.state-subscriber</a></li><li><a href="#t1111.Provider-and-connect（实战）">11.Provider-and-connect（实战）</a></li><li><a href="#t1212.结语">12.结语</a></li><li><a href="#t13参考资料">参考资料</a><ul><li><a href="#t14Flux">Flux</a></li><li><a href="#t15Redux">Redux</a></li></ul></li></ul></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h1 id="t0&#x7406;&#x89E3;Redux&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x5B9E;&#x73B0;">&#x7406;&#x89E3;Redux&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x5B9E;&#x73B0; <a href="#t0&#x7406;&#x89E3;Redux&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x5B9E;&#x73B0;"> # </a></h1>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x8FD9;&#x4E2A;&#x6559;&#x7A0B;&#x5462;&#xFF1F;</p>
<p>&#x5728;&#x6211;&#x5C1D;&#x8BD5;&#x5B66;&#x4E60; Redux &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x53D1;&#x73B0;&#x4E4B;&#x524D;&#x7684;&#x9605;&#x8BFB;&#x8FC7;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x52A0;&#x4E0A;&#x4E2A;&#x4EBA;&#x7684;&#x7ECF;&#x9A8C;&#xFF0C;
&#x8BA9;&#x6211;&#x5BF9; flux &#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E9B;&#x9519;&#x8BEF;&#x7684;&#x8BA4;&#x77E5;&#x3002;
&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4E0D;&#x662F;&#x8BF4;&#x90A3;&#x4E9B;&#x5173;&#x4E8E; flux &#x7684;&#x6587;&#x7AE0;&#x5199;&#x5F97;&#x4E0D;&#x597D;&#xFF0C;&#x53EA;&#x662F;&#x6211;&#x6CA1;&#x80FD;&#x6B63;&#x786E;&#x5730;&#x9886;&#x4F1A;&#x5176;&#x4E2D;&#x7684;&#x6982;&#x5FF5;&#x3002;
&#x5230;&#x5934;&#x6765;&#xFF0C;&#x6211;&#x53EA;&#x662F;&#x5BF9;&#x7740;&#x5404;&#x79CD; flux &#x6846;&#x67B6;&#xFF08;Reflux&#x3001;Flummox&#x3001;FB Flux&#xFF09;&#x7684;&#x6587;&#x6863;&#x7167;&#x732B;&#x753B;&#x864E;&#xFF0C;
&#x5E76;&#x8BD5;&#x7740;&#x628A;&#x5B83;&#x4EEC;&#x548C;&#x4E4B;&#x524D;&#x4E86;&#x89E3;&#x5230;&#x7684;&#x7406;&#x8BBA;&#x6982;&#x5FF5;&#x8054;&#x7CFB;&#x8D77;&#x6765;&#x3002;
&#x7B49;&#x6211;&#x7528;&#x4E86; Redux &#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x624D;&#x53D1;&#x73B0;&#x539F;&#x6765;flux&#x6BD4;&#x6211;&#x60F3;&#x8C61;&#x7684;&#x8981;&#x7B80;&#x5355;&#x5F88;&#x591A;&#x3002;
&#x8FD9;&#x4E9B;&#x90FD;&#x5F52;&#x529F;&#x4E8E; Redux &#x901A;&#x8FC7;&#x4F18;&#x826F;&#x7684;&#x8BBE;&#x8BA1;&#x6765;&#x51CF;&#x5C11;&#x6837;&#x677F;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x5176;&#x5B83;&#x6846;&#x67B6;&#x5219;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x6837;&#x677F;&#x6587;&#x4EF6;&#x5374;&#x53C8;&#x5F15;&#x5165;&#x4E86;&#x5F88;&#x591A;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#x3002;
&#x6211;&#x73B0;&#x5728;&#x89C9;&#x5F97;&#x7528;&#x901A;&#x8FC7; Redux &#x6765;&#x5B66;&#x4E60; flux &#x6BD4;&#x901A;&#x8FC7;&#x5176;&#x4ED6;&#x6846;&#x67B6;&#x9AD8;&#x6548;&#x5F97;&#x591A;&#x3002;
&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x60F3;&#x5206;&#x4EAB;&#x7ED9;&#x5927;&#x5BB6;&#xFF0C;&#x7528;&#x6211;&#x81EA;&#x5DF1;&#x7684;&#x8BDD;&#x6765;&#x8BF4;&#xFF0C;
&#x901A;&#x8FC7;&#x5173;&#x6CE8; Redux &#x7684;&#x7528;&#x6CD5;&#x6765;&#x7406;&#x89E3; flux &#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<p>&#x4F60;&#x4E00;&#x5B9A;&#x5DF2;&#x7ECF;&#x770B;&#x8FC7;&#x8FD9;&#x5F20;&#x8457;&#x540D;&#x7684; flux &#x7684;&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x56FE;&#x4E86;&#x3002;</p>
<p><img src="../..//img/redux/flux.png"></p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x6559;&#x7A0B;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x4E00;&#x6B65;&#x6B65;&#x5730;&#x5411;&#x4F60;&#x4ECB;&#x7ECD;&#x4E0A;&#x56FE;&#x91CC;&#x7684;&#x5404;&#x4E2A;&#x6982;&#x5FF5;&#x3002;
&#x6211;&#x4EEC;&#x4F1A;&#x628A;&#x8FD9;&#x4E9B;&#x6982;&#x5FF5;&#x5206;&#x6210;&#x5355;&#x72EC;&#x7684;&#x7AE0;&#x8282;&#x6765;&#x4ECB;&#x7ECD;&#x5B83;&#x4EEC;&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x548C;&#x4F5C;&#x7528;&#xFF0C;
&#x800C;&#x4E0D;&#x4F1A;&#x7B3C;&#x7EDF;&#x5730;&#x4ECB;&#x7ECD;&#x6574;&#x5F20;&#x6570;&#x636E;&#x6D41;&#x56FE;&#x3002;
&#x5728;&#x6700;&#x540E;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7406;&#x89E3;&#x4E86;&#x6BCF;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x5F20;&#x56FE;&#x771F;&#x662F;&#x610F;&#x4E49;&#x6DF1;&#x8FDC;&#x554A;&#xFF01;</p>
<p>&#x5728;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x804A;&#x4E0B;&#x4E00;flux&#x5B58;&#x5728;&#x7684;&#x610F;&#x4E49;&#x4EE5;&#x53CA;&#x6211;&#x4EEC;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x5B83;&#x3002;
&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x5E94;&#x7528;&#x4F1A;&#x7531;&#x4EC0;&#x4E48;&#x7EC4;&#x6210;&#x5462;&#xFF1F;
1) &#x6A21;&#x677F;/HTML = View
2) &#x586B;&#x5145;&#x89C6;&#x56FE;&#x7684;&#x6570;&#x636E; = Model
3) &#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x89C6;&#x56FE;&#x7EC4;&#x88C5;&#x5728;&#x4E00;&#x8D77;&#xFF0C;
  &#x7528;&#x6237;&#x4E8B;&#x4EF6;&#x6570;&#x636E;&#x53D8;&#x5316;&#x65F6;&#x7684;&#x54CD;&#x5E94;&#xFF0C;&#x7B49;&#x7B49;&#x7684;&#x903B;&#x8F91; = Controller</p>
<p>&#x8FD9;&#x5C31;&#x662F;&#x4E2A;&#x975E;&#x5E38;&#x5178;&#x578B;&#x7684; MVC&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x548C;flux&#x7684;&#x6982;&#x5FF5;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x50CF;&#x7684;&#xFF0C;
&#x53EA;&#x662F;&#x5728;&#x67D0;&#x4E9B;&#x8868;&#x8FF0;&#x4E0A;&#x6709;&#x4E9B;&#x5C0F;&#x5C0F;&#x7684;&#x4E0D;&#x540C;&#xFF1A;</p>
<ul>
<li>Model &#x770B;&#x8D77;&#x6765;&#x50CF; Store</li>
<li>&#x7528;&#x6237;&#x4E8B;&#x4EF6;&#x3001;&#x6570;&#x636E;&#x53D8;&#x5316;&#x4EE5;&#x53CA;&#x5B83;&#x4EEC;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x770B;&#x8D77;&#x6765;&#x50CF;
&quot;action creators&quot; -&gt; action -&gt; dispatcher -&gt; callback</li>
<li>View &#x770B;&#x8D77;&#x6765;&#x50CF; React views (&#x6216;&#x8005;&#x5176;&#x4ED6;&#x4EC0;&#x4E48;&#x7684;)</li>
</ul>
<p>&#x6240;&#x4EE5;&#xFF0C;flux &#x5C31;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x540D;&#x8BCD;&#x4E48;&#xFF1F;&#x4E0D;&#x5168;&#x662F;&#xFF0C;&#x4F46;&#x662F;&#x65B0;&#x540D;&#x8BCD;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#xFF0C;
&#x56E0;&#x4E3A;&#x901A;&#x8FC7;&#x5F15;&#x5165;&#x8FD9;&#x4E9B;&#x65B0;&#x672F;&#x8BED;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x8868;&#x8FF0;&#x5404;&#x79CD;&#x4E13;&#x4E1A;&#x672F;&#x8BED;&#x3002;
&#x4E3E;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x662F;&#x4E00;&#x4E2A; action&#xFF0C;&#x4E00;&#x4E2A;&#x70B9;&#x51FB;&#x662F;&#x4E00;&#x4E2A; action&#xFF0C;
&#x4E00;&#x4E2A;input&#x53D8;&#x5316;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;action&#x7B49;&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x90FD;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x4E86;&#x4ECE;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x91CC;&#x5206;&#x53D1; action&#xFF0C;
&#x53EA;&#x662F;&#x4EE5;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x79F0;&#x547C;&#x5B83;&#x4EEC;&#x3002; &#x4E0D;&#x540C;&#x4E8E;&#x76F4;&#x63A5;&#x4FEE;&#x6539; Model &#x548C; View&#xFF0C;
Flux &#x786E;&#x4FDD;&#x6240;&#x6709; action &#x9996;&#x5148;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;dispatcher&#xFF0C;
&#x7136;&#x540E;&#x518D;&#x662F;store&#xFF0C;&#x6700;&#x540E;&#x901A;&#x77E5;&#x6240;&#x6709;&#x7684;store&#x89C2;&#x6D4B;&#x8005;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5F04;&#x6E05;&#x695A;MVC&#x548C;flux&#x7684;&#x4E0D;&#x540C;&#xFF0C;
&#x6211;&#x4EEC;&#x4E3E;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;MVC&#x5E94;&#x7528;&#x7684;&#x7528;&#x4F8B;&#xFF1A;
&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;MVC&#x5E94;&#x7528;&#x7684;&#x6D41;&#x7A0B;&#x5927;&#x81F4;&#x4E0A;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;
1) &#x7528;&#x6237;&#x70B9;&#x51FB;&#x6309;&#x94AE;&#x201C;A&#x201D;
2) &#x70B9;&#x51FB;&#x6309;&#x94AE;&#x201C;A&#x201D;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x89E6;&#x53D1; Model &#x201C;A&#x201D;&#x7684;&#x6539;&#x53D8;
3) Model &#x201C;A&#x201D;&#x7684;&#x6539;&#x53D8;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x89E6;&#x53D1; Model &#x201C;B&#x201D;&#x7684;&#x6539;&#x53D8;
4) Model &#x201C;B&#x201D;&#x7684;&#x6539;&#x53D8;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x89E6;&#x53D1; View &#x201C;B&#x201D;&#x7684;&#x6539;&#x53D8;&#x5E76;&#x91CD;&#x65B0;&#x6E32;&#x67D3;&#x81EA;&#x8EAB;</p>
<p>&#x5728;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x73AF;&#x5883;&#x91CC;&#xFF0C;&#x5F53;&#x5E94;&#x7528;&#x51FA;&#x9519;&#x7684;&#x65F6;&#x5019;&#x5FEB;&#x901F;&#x5730;&#x5B9A;&#x4F4D; bug &#x6765;&#x6E90;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x56F0;&#x96BE;&#x7684;&#x4E8B;&#x60C5;&#x3002;
&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A; View &#x53EF;&#x4EE5;&#x76D1;&#x89C6;&#x4EFB;&#x4F55;&#x7684; Model&#xFF0C;
&#x5E76;&#x4E14;&#x6BCF;&#x4E2A; Model &#x53EF;&#x4EE5;&#x76D1;&#x89C6;&#x5176;&#x5B83;&#x6240;&#x6709; Model&#xFF0C;&#x6240;&#x4EE5;&#x6570;&#x636E;&#x4F1A;&#x4ECE;&#x56DB;&#x9762;&#x516B;&#x65B9;&#x6D8C;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x88AB;&#x8BB8;&#x591A;&#x6E90;&#xFF08;view &#x6216;&#x8005; model&#xFF09;&#x6539;&#x53D8;&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x7528; flux &#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x4F1A;&#x53D8;&#x6210;&#x8FD9;&#x6837;&#x5B50;&#xFF1A;
1) &#x7528;&#x6237;&#x70B9;&#x51FB;&#x6309;&#x94AE;&#x201C;A&#x201D;
2) &#x70B9;&#x51FB;&#x6309;&#x94AE;&#x201C;A&#x201D;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F1A;&#x89E6;&#x53D1;&#x4E00;&#x4E2A;&#x88AB;&#x5206;&#x53D1;&#x7684; action&#xFF0C;&#x5E76;&#x6539;&#x53D8; Store &#x201C;A&#x201D;
3) &#x56E0;&#x4E3A;&#x5176;&#x5B83;&#x7684; Store &#x4E5F;&#x88AB;&#x8FD9;&#x4E2A; action &#x901A;&#x77E5;&#x4E86;&#xFF0C;&#x6240;&#x4EE5; Store &#x201C;B&#x201D;&#x4E5F;&#x4F1A;&#x5BF9;&#x76F8;&#x540C;&#x7684; action &#x505A;&#x51FA;&#x53CD;&#x5E94;
4) View &#x201C;B&#x201D;&#x56E0;&#x4E3A; Store  A &#x548C; Store B&#x7684;&#x6539;&#x53D8;&#x800C;&#x6536;&#x5230;&#x901A;&#x77E5;&#xFF0C;&#x5E76;&#x91CD;&#x65B0;&#x6E32;&#x67D3;</p>
<p>&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x662F;&#x5982;&#x4F55;&#x907F;&#x514D; Store A &#x548C; Store B &#x76F4;&#x63A5;&#x76F8;&#x5173;&#x8054;&#x7684;&#x3002;
&#x6BCF;&#x4E00;&#x4E2A; Store &#x53EA;&#x80FD;&#x88AB;&#x4E00;&#x4E2A; action &#x4FEE;&#x6539;&#xFF0C;&#x522B;&#x65E0;&#x4ED6;&#x9009;&#x3002;
&#x5E76;&#x4E14;&#x5F53;&#x6240;&#x6709; Store &#x56DE;&#x5E94;&#x4E86; action &#x540E;&#xFF0C;&#x6700;&#x7EC8;&#x6240;&#x6709; View &#x90FD;&#x4F1A;&#x66F4;&#x65B0;&#x3002;&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;&#x6570;&#x636E;&#x603B;&#x662F;&#x6CBF;&#x4E00;&#x4E2A;&#x65B9;&#x5411;&#x8FDB;&#x884C;&#x6D41;&#x52A8;&#xFF1A;</p>
<pre><code>   action -&gt; store -&gt; view -&gt; action -&gt; store -&gt; view -&gt; action -&gt; ...
</code></pre><p>&#x5C31;&#x50CF;&#x6211;&#x4EEC;&#x4ECE;&#x4E00;&#x4E2A; action &#x5F00;&#x59CB;&#x6211;&#x4EEC;&#x7684;&#x7528;&#x4F8B;&#xFF0C;
&#x8BA9;&#x6211;&#x4EEC;&#x4EE5; action &#x548C; action creator &#x6765;&#x5F00;&#x59CB;&#x6211;&#x4EEC;&#x7684;&#x6559;&#x7A0B;&#x3002;</p>
<h2 id="t11.simple-action-creator">1.simple-action-creator <a href="#t11.simple-action-creator"> # </a></h2>
<p>&#x6211;&#x4EEC;&#x5728;&#x524D;&#x8A00;&#x4E2D;&#x5DF2;&#x7ECF;&#x7B80;&#x5355;&#x63D0;&#x5230;&#x8FC7; action&#xFF0C;&#x4F46;&#x5177;&#x4F53;&#x4EC0;&#x4E48;&#x662F; &quot;action creator&quot;&#xFF0C;&#x5B83;&#x4EEC;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x5173;&#x8054;&#x5230; &quot;action&quot; &#x7684;&#x5462;&#xFF1F;</p>
<p>&#x5176;&#x5B9E;&#xFF0C;&#x901A;&#x8FC7;&#x51E0;&#x884C;&#x7B80;&#x5355;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x91CA;&#x6E05;&#x695A;&#x4E86;&#xFF01;</p>
<p>action creator &#x5C31;&#x662F;&#x51FD;&#x6570;&#x800C;&#x5DF2;...</p>
<pre><code>var actionCreator = function() {
   ...&#x8D1F;&#x8D23;&#x6784;&#x5EFA;&#x4E00;&#x4E2A; action &#xFF08;&#x662F;&#x7684;&#xFF0C;action creator &#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x5DF2;&#x7ECF;&#x5F88;&#x660E;&#x663E;&#x4E86;&#xFF09;&#x5E76;&#x8FD4;&#x56DE;&#x5B83;
  return {
      type: &apos;AN_ACTION&apos;
  }
}
</code></pre><p>&#x8FD9;&#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x662F;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;&#x6709;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x90A3;&#x5C31;&#x662F; action &#x7684;&#x683C;&#x5F0F;&#x3002;&#x5728; flux &#x4E2D;&#xFF0C;&#x4E00;&#x822C;&#x7EA6;&#x5B9A; action &#x662F;&#x4E00;&#x4E2A;&#x62E5;&#x6709; &#x201C;type&#x201D; &#x5C5E;&#x6027;&#x7684;&#x5BF9;&#x8C61;&#x3002;
&#x8FD9;&#x4E2A; &#x201C;type&#x201D; &#x5728;&#x4EE5;&#x540E;&#x5904;&#x7406; action &#x65F6;&#x4F1A;&#x7528;&#x5230;&#x3002;&#x5F53;&#x7136;&#xFF0C;action &#x4F9D;&#x65E7;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x5B58;&#x653E;&#x60F3;&#x8981;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<p>&#x5728;&#x540E;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0; action creator &#x5B9E;&#x9645;&#x4E0A;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE; action &#x4EE5;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x4E1C;&#x897F;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;
&#x8FD9;&#x5728;&#x5F02;&#x6B65; action &#x5904;&#x7406;&#x4E2D;&#x6781;&#x4E3A;&#x6709;&#x7528;&#xFF08;&#x66F4;&#x591A;&#x7684;&#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x67E5;&#x9605; dispatch-async-action.js&#xFF09;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528; action creator&#xFF0C;&#x5982;&#x540C;&#x9884;&#x671F;&#x7684;&#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5F97;&#x5230;&#x4E00;&#x4E2A; action&#xFF1A;</p>
<pre><code>console.log(actionCreator())
</code></pre><p>&#x8F93;&#x51FA;&#xFF1A; { type: &apos;AN_ACTION&apos; }</p>
<p>&#x597D;&#x4E86;&#xFF0C;&#x4EE5;&#x4E0A;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5565;&#x7528;&#x4E5F;&#x6CA1;&#x6709;...
&#x5728;&#x5B9E;&#x9645;&#x7684;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x662F;&#x5C06; action &#x53D1;&#x9001;&#x5230;&#x67D0;&#x4E2A;&#x5730;&#x65B9;&#xFF0C;&#x8BA9;&#x4EFB;&#x4F55;&#x5173;&#x5FC3;&#x5B83;&#x7684;&#x4EBA;&#x77E5;&#x9053;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#xFF0C;&#x5E76;&#x4E14;&#x505A;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;
&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x79F0;&#x4E4B;&#x4E3A;&#x201C;&#x5206;&#x53D1; action&#xFF08;Dispatching an action&#xFF09;&#x201D;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5206;&#x53D1; action&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;...&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x51FD;&#x6570;&#xFF08;=&#xFFE3;&#x3C9;&#xFFE3;=&#xFF09;&#x3002;
&#x5E76;&#x4E14;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x4EFB;&#x4F55;&#x5BF9;&#x5B83;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4EBA;&#x53EF;&#x4EE5;&#x611F;&#x77E5;&#x5230; action &#x88AB;&#x53D1;&#x8D77;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x6CE8;&#x518C;&#x201C;&#x5904;&#x7406;&#x5668;&#xFF08;handlers&#xFF09;&#x201D;&#x7684;&#x673A;&#x5236;&#x3002;
&#x8FD9;&#x4E9B; action &#x7684;&#x201C;&#x5904;&#x7406;&#x5668;&#x201D;&#x5728;&#x4F20;&#x7EDF;&#x7684; flux &#x5E94;&#x7528;&#x4E2D;&#x88AB;&#x79F0;&#x4E3A; store&#xFF0C;&#x5728;&#x4E0B;&#x4E2A;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x4E86;&#x89E3;&#x5230;&#x5B83;&#x4EEC;&#x5728; redux &#x4E2D;&#x88AB;&#x79F0;&#x4E3A;&#x4EC0;&#x4E48;&#x3002;</p>
<p>&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4EE5;&#x4E0B;&#x6D41;&#x7A0B;&#xFF1A;</p>
<pre><code>ActionCreator -&gt; Action
</code></pre><p>&#x53EF;&#x4EE5;&#x5728;&#x4EE5;&#x4E0B;&#x94FE;&#x63A5;&#x4E2D;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x5173;&#x4E8E; action &#x548C; action creator &#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<p>http:rackt.org/redux/docs/recipes/ReducingBoilerplate.html</p>
<h2 id="t22.about-state-and-meet-redux">2.about-state-and-meet-redux <a href="#t22.about-state-and-meet-redux"> # </a></h2>
<p>&#x6709;&#x65F6;&#x6211;&#x4EEC;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x6240;&#x5904;&#x7406;&#x7684;&#x52A8;&#x4F5C;&#x4E0D;&#x4EC5;&#x544A;&#x77E5;&#x6211;&#x4EEC;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#x4E8B;&#xFF0C;&#x800C;&#x4E14;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x968F;&#x4E4B;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x3002;</p>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x5E94;&#x7528;&#x800C;&#x8A00;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x52A8;&#x4F5C;&#x90FD;&#x663E;&#x5F97;&#x975E;&#x5E38;&#x68D8;&#x624B;&#x3002;
&#x5982;&#x4F55;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x5185;&#x7EF4;&#x6301;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF1F;
&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF1F;
&#x5982;&#x4F55;&#x628A;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x4F20;&#x64AD;&#x5230;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF1F;</p>
<p>&#x4E8E;&#x662F; Redux &#x767B;&#x573A;&#x3002;</p>
<p>Redux (https:github.com/rackt/redux) &#x662F;&#x4E00;&#x4E2A;&#x300E;&#x53EF;&#x9884;&#x6D4B;&#x5316;&#x72B6;&#x6001;&#x7684; JavaScript &#x5BB9;&#x5668;&#x300F;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x56DE;&#x987E;&#x4E0A;&#x8FF0;&#x63D0;&#x51FA;&#x7684;&#x95EE;&#x9898;&#x5E76;&#x7528; Redux &#x7684;&#x8BCD;&#x6C47;&#x8868;&#x7ED9;&#x51FA;&#x4EE5;&#x4E0B;&#x89E3;&#x7B54;&#xFF08;&#x90E8;&#x5206;&#x8BCD;&#x6C47;&#x4E5F;&#x6765;&#x6E90;&#x4E8E; Flux&#xFF09;&#xFF1A;</p>
<p>&#x5982;&#x4F55;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x5185;&#x7EF4;&#x6301;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF1F;
    &#x4EE5;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x65B9;&#x5F0F;&#x7EF4;&#x6301;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F8B;&#x5982; JavaScript &#x5BF9;&#x8C61;&#x3001;&#x6570;&#x7EC4;&#x3001;&#x4E0D;&#x53EF;&#x53D8;&#x6570;&#x636E;&#xFF0C;&#x7B49;&#x7B49;&#x3002;
    &#x6211;&#x4EEC;&#x628A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6570;&#x636E;&#x79F0;&#x4E3A;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x662F;&#x6709;&#x9053;&#x7406;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5E94;&#x7528;&#x7684;&#x72B6;&#x6001;&#x3002;
    &#x4F46;&#x662F;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x4E9B;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x8F6C;&#x4EA4;&#x7ED9;&#x4E86; Redux&#xFF08;&#x8FD8;&#x8BB0;&#x5F97;&#x4E48;&#xFF1F;Redux &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x300E;&#x5BB9;&#x7EB3;&#x72B6;&#x6001;&#x7684;&#x5BB9;&#x5668;&#x300F;&#xFF09;&#x3002;
&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF1F;
    &#x6211;&#x4EEC;&#x4F7F;&#x7528; reducer &#x51FD;&#x6570;&#x4FEE;&#x6539;&#x6570;&#x636E;&#xFF08;&#x5728;&#x4F20;&#x7EDF;&#x7684; Flux &#x4E2D;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A; store&#xFF09;&#x3002;
    Reducer &#x51FD;&#x6570;&#x662F; actions &#x7684;&#x8BA2;&#x9605;&#x8005;&#x3002;
    Reducer &#x51FD;&#x6570;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7EAF;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x63A5;&#x6536;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x53D1;&#x751F;&#x7684; action&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x65B0;&#x72B6;&#x6001;&#xFF08;&#x6216;&#x8005;&#x6709;&#x4EBA;&#x79F0;&#x4E4B;&#x4E3A;&#x5F52;&#x5E76;&#x540E;&#x7684;&#x72B6;&#x6001;&#xFF09;&#x3002;
&#x5982;&#x4F55;&#x628A;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x4F20;&#x64AD;&#x5230;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF1F;
    &#x4F7F;&#x7528;&#x8BA2;&#x9605;&#x8005;&#x6765;&#x76D1;&#x542C;&#x72B6;&#x6001;&#x7684;&#x53D8;&#x66F4;&#x60C5;&#x51B5;&#x3002;</p>
<p>Redux &#x5E2E;&#x4F60;&#x628A;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x3002;
&#x603B;&#x4E4B; Redux &#x63D0;&#x4F9B;&#x4E86;&#xFF1A;
   1&#xFF09;&#x5B58;&#x653E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x7684;&#x5BB9;&#x5668;
   2&#xFF09;&#x4E00;&#x79CD;&#x628A; action &#x5206;&#x53D1;&#x5230;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x5668;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; reducer &#x51FD;&#x6570;
   3&#xFF09;&#x76D1;&#x542C;&#x72B6;&#x6001;&#x53D8;&#x5316;&#x7684;&#x673A;&#x5236;</p>
<p>&#x6211;&#x4EEC;&#x628A; Redux &#x5B9E;&#x4F8B;&#x79F0;&#x4E3A; store &#x5E76;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#xFF1A;</p>
<pre><code>  import { createStore } from &apos;redux&apos;
  var store = createStore()
</code></pre><p>&#x4F46;&#x662F;&#x5F53;&#x4F60;&#x8FD0;&#x884C;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x4EE5;&#x4E0B;&#x5F02;&#x5E38;&#x6D88;&#x606F;&#xFF1A;</p>
<pre><code>   Error: Invariant Violation: Expected the reducer to be a function.
</code></pre><p>&#x8FD9;&#x662F;&#x56E0;&#x4E3A; createStore &#x51FD;&#x6570;&#x5FC5;&#x987B;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x80FD;&#x591F;&#x4FEE;&#x6539;&#x5E94;&#x7528;&#x72B6;&#x6001;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x518D;&#x8BD5;&#x4E00;&#x4E0B;</p>
<pre><code>import { createStore } from &apos;redux&apos;

var store = createStore(() =&gt; {})
</code></pre><p>&#x770B;&#x4E0A;&#x53BB;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x4E86;...</p>
<h2 id="t33.simple-reducer">3.simple-reducer <a href="#t33.simple-reducer"> # </a></h2>
<p>&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x53BB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Redux &#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x8BA9;&#x5B83;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x4E2D;&#x7684; state
&#x4E0B;&#x9762;&#x8BB2;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B; reducer &#x51FD;&#x6570;&#x662F;&#x5982;&#x4F55;&#x8F6C;&#x6362; state &#x7684;&#x3002;</p>
<p>Reducer &#x4E0E; Store &#x533A;&#x522B;&#xFF1A;
&#x4F60;&#x53EF;&#x80FD;&#x5DF2;&#x7ECF;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x5728;&#x7B80;&#x4ECB;&#x7AE0;&#x8282;&#x4E2D;&#x7684; Flux &#x56FE;&#x8868;&#x4E2D;&#xFF0C;&#x6709; &quot;Store&quot;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;
Redux &#x4E2D;&#x6240;&#x62E5;&#x6709;&#x7684; &quot;Reducer&quot;&#x3002;&#x90A3;&#x4E48;&#xFF0C;Store &#x4E0E; Reducer &#x5230;&#x5E95;&#x6709;&#x54EA;&#x4E9B;&#x533A;&#x522B;&#x5462;&#xFF1F;
&#x5B9E;&#x9645;&#x7684;&#x533A;&#x522B;&#x6BD4;&#x4F60;&#x60F3;&#x8C61;&#x7684;&#x7B80;&#x5355;&#xFF1A;Store &#x53EF;&#x4EE5;&#x4FDD;&#x5B58;&#x4F60;&#x7684; data&#xFF0C;&#x800C; Reducer &#x4E0D;&#x80FD;&#x3002;
&#x56E0;&#x6B64;&#x5728;&#x4F20;&#x7EDF;&#x7684; Flux &#x4E2D;&#xFF0C;Store &#x672C;&#x8EAB;&#x53EF;&#x4EE5;&#x4FDD;&#x5B58; state&#xFF0C;&#x4F46;&#x5728; Redux &#x4E2D;&#xFF0C;&#x6BCF;&#x6B21;&#x8C03;&#x7528; reducer
&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x4F20;&#x5165;&#x5F85;&#x66F4;&#x65B0;&#x7684; state&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;Redux &#x7684; store &#x5C31;&#x53D8;&#x6210;&#x4E86;
&#x201C;&#x65E0;&#x72B6;&#x6001;&#x7684; store&#x201D; &#x5E76;&#x4E14;&#x6539;&#x4E86;&#x4E2A;&#x540D;&#x5B57;&#x53EB; Reducer&#x3002;</p>
<p>&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;&#x5728;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Redux &#x5B9E;&#x4F8B;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x7ED9;&#x5B83;&#x4E00;&#x4E2A; reducer &#x51FD;&#x6570;...</p>
<pre><code>import { createStore } from &apos;redux&apos;

var store_0 = createStore(() =&gt; {})
</code></pre><p>... &#x56E0;&#x6B64;&#x6BCF;&#x5F53;&#x4E00;&#x4E2A; action &#x53D1;&#x751F;&#x65F6;&#xFF0C;Redux &#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;
&#x5F80; createStore &#x4F20; Reducer &#x7684;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x7ED9; Redux &#x7ED1;&#x5B9A; action &#x5904;&#x7406;&#x51FD;&#x6570;&#xFF08;&#x4E5F;&#x5C31;&#x662F; Reducer&#xFF09;&#x7684;&#x8FC7;&#x7A0B;&#x3002;
action &#x5904;&#x7406;&#x51FD;&#x6570;&#x5728; 01_simple-action-creator.js &#x7AE0;&#x8282;&#x4E2D;&#x6709;&#x8BA8;&#x8BBA;&#x8FC7;&#x3002;</p>
<p>&#x5728; Reducer &#x4E2D;&#x6253;&#x5370;&#x4E00;&#x4E9B; log</p>
<pre><code>var reducer = function (...args) {
  console.log(&apos;Reducer was called with args&apos;, args)
}

var store_1 = createStore(reducer)
</code></pre><p>&#x8F93;&#x51FA;&#xFF1A;Reducer was called with args [ undefined, { type: &apos;@@redux/INIT&apos; } ]</p>
<p>&#x770B;&#x51FA;&#x6765;&#x4E86;&#x5417;&#xFF1F;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x7684; reducer &#x88AB;&#x8C03;&#x7528;&#x4E86;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x6CA1;&#x6709; dispatch &#x4EFB;&#x4F55; action...
&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x521D;&#x59CB;&#x5316;&#x5E94;&#x7528; state &#x7684;&#x65F6;&#x5019;&#xFF0C;
Redux dispatch &#x4E86;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7684; action ({ type: &apos;@@redux/INIT&apos; })</p>
<p>&#x5728;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x4E00;&#x4E2A; reducer &#x4F1A;&#x5F97;&#x5230;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#xFF1A;(state, action)
&#x5728;&#x5E94;&#x7528;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;state &#x8FD8;&#x6CA1;&#x88AB;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x7684;&#x503C;&#x662F; &quot;undefined&quot;&#xFF0C;
&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x7B26;&#x5408;&#x903B;&#x8F91;&#x7684;</p>
<p>&#x5728; Redux &#x53D1;&#x9001; &quot;init&quot; action &#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x7528;&#x4E2D;&#x7684; state &#x53C8;&#x4F1A;&#x662F;&#x600E;&#x4E48;&#x6837;&#x7684;&#x5462;&#xFF1F;</p>
<h2 id="t44.get-state">4.get-state <a href="#t44.get-state"> # </a></h2>
<p>How do we retrieve the state from our Redux instance?</p>
<pre><code>import { createStore } from &apos;redux&apos;

var reducer_0 = function (state, action) {
  console.log(&apos;reducer_0 was called with state&apos;, state, &apos;and action&apos;, action)
}

var store_0 = createStore(reducer_0)
Output: reducer_0 was called with state undefined and action { type: &apos;@@redux/INIT&apos; }
</code></pre><p>To get the state that Redux is holding for us, you call getState</p>
<p>console.log(&apos;store_0 state after initialization:&apos;, store_0.getState())
Output: store_0 state after initialization: undefined</p>
<p>So the state of our application is still undefined after the initialization? Well of course it is,
our reducer is not doing anything... Remember how we described the expected behavior of a reducer in
&quot;about-state-and-meet-redux&quot;?
   &quot;A reducer is just a function that receives the current state of your application, the action,
   and returns a new state modified (or reduced as they call it)&quot;
Our reducer is not returning anything right now so the state of our application is what
reducer() returns, hence &quot;undefined&quot;.</p>
<p>Let&apos;s try to send an initial state of our application if the state given to reducer is undefined:</p>
<pre><code>var reducer_1 = function (state, action) {
  console.log(&apos;reducer_1 was called with state&apos;, state, &apos;and action&apos;, action)
  if (typeof state === &apos;undefined&apos;) {
      return {}
  }

  return state;
}

var store_1 = createStore(reducer_1)
Output: reducer_1 was called with state undefined and action { type: &apos;@@redux/INIT&apos; }
</code></pre><p>console.log(&apos;store_1 state after initialization:&apos;, store_1.getState())
Output: store_1 state after initialization: {}</p>
<p>As expected, the state returned by Redux after initialization is now {}</p>
<p>There is however a much cleaner way to implement this pattern thanks to ES6:</p>
<p>var reducer_2 = function (state = {}, action) {
  console.log(&apos;reducer_2 was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  return state;
}</p>
<p>var store_2 = createStore(reducer_2)
Output: reducer_2 was called with state {} and action { type: &apos;@@redux/INIT&apos; }</p>
<p>console.log(&apos;store_2 state after initialization:&apos;, store_2.getState())
Output: store_2 state after initialization: {}</p>
<p>You&apos;ve probably noticed that since we&apos;ve used the default parameter on state parameter of reducer_2,
we no longer get undefined as state&apos;s value in our reducer&apos;s body.</p>
<p>Let&apos;s now recall that a reducer is only called in response to an action dispatched and
let&apos;s fake a state modification in response to an action type &apos;SAY_SOMETHING&apos;</p>
<p>var reducer_3 = function (state = {}, action) {
  console.log(&apos;reducer_3 was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
      case &apos;SAY_SOMETHING&apos;:
          return {
              ...state,
              message: action.value
          }
      default:
          return state;
  }
}</p>
<p>var store_3 = createStore(reducer_3)
Output: reducer_3 was called with state {} and action { type: &apos;@@redux/INIT&apos; }</p>
<p>console.log(&apos;store_3 state after initialization:&apos;, store_3.getState())
Output: redux state after initialization: {}</p>
<p>Nothing new in our state so far since we did not dispatch any action yet. But there are few
important things to pay attention to in the last example:
   0) I assumed that our action contains a type and a value property. The type property is mostly
      a convention in flux actions and the value property could have been anything else.
   1) You&apos;ll often see the pattern involving a switch to respond appropriately
      to an action received in your reducers
   2) When using a switch, NEVER forget to have a &quot;default: return state&quot; because
      if you don&apos;t, you&apos;ll end up having your reducer return undefined (and lose your state).
   3) Notice how we returned a new state made by merging current state with { message: action.value },
      all that thanks to this awesome ES7 notation (Object Spread): { ...state, message: action.value }
   4) Note also that this ES7 Object Spread notation suits our example because it&apos;s doing a shallow
      copy of { message: action.value } over our state (meaning that first level properties of state
      are completely overwritten - as opposed to gracefully merged - by first level property of
      { message: action.value }). But if we had a more complex / nested data structure, you might choose
      to handle your state&apos;s updates very differently:</p>
<pre><code>  - using Immutable.js (https:facebook.github.io/immutable-js/)
  - using Object.assign (https:developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
  - using manual merge
  - or whatever other strategy that suits your needs and the structure of your state since
    Redux is absolutely NOT opinionated on this (remember, Redux is a state container).
</code></pre><p>Now that we&apos;re starting to handle actions in our reducer let&apos;s talk about having multiple reducers and
combining them.</p>
<h2 id="t55.combine-reducers">5.combine-reducers <a href="#t55.combine-reducers"> # </a></h2>
<p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x4EC0;&#x4E48;&#x662F; reducer</p>
<p>var reducer_0 = function (state = {}, action) {
  console.log(&apos;reducer_0 was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
      case &apos;SAY_SOMETHING&apos;:
          return {
              ...state,
              message: action.value
          }
      default:
          return state;
  }
}</p>
<p>&#x5728;&#x7EE7;&#x7EED;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x62E5;&#x6709;&#x5F88;&#x591A; action &#x7684; reducer &#x957F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;</p>
<p>var reducer_1 = function (state = {}, action) {
  console.log(&apos;reducer_1 was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
      case &apos;SAY_SOMETHING&apos;:
          return {
              ...state,
              message: action.value
          }
      case &apos;DO_SOMETHING&apos;:
           ...
      case &apos;LEARN_SOMETHING&apos;:
           ...
      case &apos;HEAR_SOMETHING&apos;:
           ...
      case &apos;GO_SOMEWHERE&apos;:
           ...
       etc.
      default:
          return state;
  }
}</p>
<p>&#x5F88;&#x663E;&#x7136;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A; reducer &#x662F;hold&#x4E0D;&#x4F4F;&#x6211;&#x4EEC;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x4E2D;&#x6240;&#x6709; action &#x64CD;&#x4F5C;&#x7684;&#xFF08;&#x597D;&#x5427;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x5B83;&#x662F; hold &#x5F97;&#x4F4F;&#x7684;&#xFF0C;
&#x4F46;&#x8FD9;&#x4F1A;&#x53D8;&#x5F97;&#x5F88;&#x96BE;&#x7EF4;&#x62A4;&#x3002;&#xFF09;</p>
<p>&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;Redux &#x4E0D;&#x5173;&#x5FC3;&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x662F;&#x53EA;&#x6709;&#x4E00;&#x4E2A; reducer &#xFF0C;&#x8FD8;&#x662F;&#x6709;&#x4E00;&#x6253;&#xFF08;12&#x4E2A;&#xFF09;reducer &#x3002;
&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;&#x591A;&#x4E2A; reducer &#xFF0C;Redux &#x80FD;&#x5E2E;&#x6211;&#x4EEC;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x5B9A;&#x4E49; 2 &#x4E2A; reducer</p>
<p>var userReducer = function (state = {}, action) {
  console.log(&apos;userReducer was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
       etc.
      default:
          return state;
  }
}
var itemsReducer = function (state = [], action) {
  console.log(&apos;itemsReducer was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
       etc.
      default:
          return state;
  }
}</p>
<p>&#x6211;&#x5E0C;&#x671B;&#x4F60;&#x7279;&#x522B;&#x7559;&#x610F;&#x8D4B;&#x7ED9;&#x6BCF;&#x4E2A; reducer &#x7684;&#x521D;&#x59CB; state &#xFF1A;</p>
<ol>
<li>&#x8D4B;&#x7ED9; userReducer &#x7684;&#x521D;&#x59CB; state &#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x5BF9;&#x8C61;&#xFF0C;&#x5373; {}</li>
<li>&#x8D4B;&#x7ED9; itemsReducer &#x7684;&#x521D;&#x59CB; state &#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x6570;&#x7EC4;&#xFF0C;&#x5373; []
&#x8D4B;&#x4E88;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x503C;&#x662F;&#x4E3A;&#x4E86;&#x8BF4;&#x660E; reducer &#x662F;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x3002;&#x4F60;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x90A3;&#x4E9B;&#x7B26;&#x5408;&#x4F60;&#x7684;&#x9700;&#x6C42;&#x7684;
&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4F5C;&#x4E3A; state &#x7684;&#x503C;&#x3002;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x5B57;&#x9762;&#x91CF;&#x5BF9;&#x8C61;&#x3001;&#x6570;&#x7EC4;&#x3001;&#x5E03;&#x5C14;&#x503C;&#x3001;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x5176;&#x5B83;&#x4E0D;&#x53EF;&#x53D8;&#x7ED3;&#x6784;&#xFF09;</li>
</ol>
<p>&#x5728;&#x8FD9;&#x79CD;&#x591A;&#x4E2A; reducer &#x7684;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x6BCF;&#x4E2A; reducer &#x53EA;&#x5904;&#x7406;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x7684;&#x90E8;&#x5206; state &#x3002;</p>
<p>&#x4F46;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#xFF0C;createStore &#x53EA;&#x63A5;&#x6536;&#x4E00;&#x4E2A; reducer &#x51FD;&#x6570;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x600E;&#x4E48;&#x5408;&#x5E76;&#x6240;&#x6709;&#x7684; reducer &#xFF1F; &#x6211;&#x4EEC;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x544A;&#x8BC9; Redux &#x6BCF;&#x4E2A; reducer &#x53EA;&#x5904;&#x7406;&#x4E00;&#x90E8;&#x5206; state &#x5462;&#xFF1F;
&#x5176;&#x5B9E;&#x8FD9;&#x5F88;&#x7B80;&#x5355;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528; combineReducers &#x8F85;&#x52A9;&#x51FD;&#x6570;&#x3002;</p>
<p>combineReducers &#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF08;hash&#xFF09;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5F53; combineReducers &#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x53BB;&#x8C03;&#x7528;&#x6BCF;&#x4E2A;
reducer &#xFF0C;&#x5E76;&#x628A;&#x8FD4;&#x56DE;&#x7684;&#x6BCF;&#x4E00;&#x5757; state &#x91CD;&#x65B0;&#x7EC4;&#x5408;&#x6210;&#x4E00;&#x4E2A;&#x5927; state &#x5BF9;&#x8C61;&#xFF08;&#x4E5F;&#x5C31;&#x662F; Redux &#x4E2D;&#x7684; Store&#xFF09;&#x3002;
&#x957F;&#x8BDD;&#x77ED;&#x8BF4;&#xFF0C;&#x4E0B;&#x9762;&#x6F14;&#x793A;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x591A;&#x4E2A; reducer &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Redux &#x5B9E;&#x4F8B;&#xFF1A;</p>
<p>import { createStore, combineReducers } from &apos;redux&apos;</p>
<p>var reducer = combineReducers({
  user: userReducer,
  items: itemsReducer
})
&#x8F93;&#x51FA;&#xFF1A;
userReducer was called with state {} and action { type: &apos;@@redux/INIT&apos; }
userReducer was called with state {} and action { type: &apos;@@redux/PROBE_UNKNOWN_ACTION_9.r.k.r.i.c.n.m.i&apos; }
itemsReducer was called with state [] and action { type: &apos;@@redux/INIT&apos; }
itemsReducer was called with state [] and action { type: &apos;@@redux/PROBE_UNKNOWN_ACTION_4.f.i.z.l.3.7.s.y.v.i&apos; }
var store_0 = createStore(reducer)
&#x8F93;&#x51FA;&#xFF1A;
userReducer was called with state {} and action { type: &apos;@@redux/INIT&apos; }
itemsReducer was called with state [] and action { type: &apos;@@redux/INIT&apos; }</p>
<p>&#x6B63;&#x5982;&#x4F60;&#x4ECE;&#x8F93;&#x51FA;&#x4E2D;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A; reducer &#x90FD;&#x88AB;&#x6B63;&#x786E;&#x5730;&#x8C03;&#x7528;&#x4E86;&#xFF08;&#x4F46;&#x63A5;&#x6536;&#x4E86;&#x4E2A; init action @@redux/INIT &#xFF09;&#x3002;
&#x8FD9;&#x4E2A; action &#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;&#x8FD9;&#x662F; combineReducers &#x5B9E;&#x65BD;&#x7684;&#x4E00;&#x6B21;&#x5B89;&#x5168;&#x68C0;&#x67E5;&#xFF0C;&#x7528;&#x4EE5;&#x786E;&#x4FDD; reducer &#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;
undefined&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728; combineReducers &#x4E2D;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528; init action &#x65F6;&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x968F;&#x673A; action &#x6765;&#x7684;&#xFF0C;
&#x4F46;&#x5B83;&#x4EEC;&#x6709;&#x4E2A;&#x5171;&#x540C;&#x7684;&#x76EE;&#x7684; (&#x5373;&#x662F;&#x505A;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x68C0;&#x67E5;)&#x3002;</p>
<p>console.log(&apos;store_0 state after initialization:&apos;, store_0.getState())
&#x8F93;&#x51FA;&#xFF1A;
store_0 state after initialization: { user: {}, items: [] }</p>
<p>&#x6709;&#x8DA3;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0; Redux &#x6B63;&#x786E;&#x5904;&#x7406;&#x4E86; state &#x7684;&#x5404;&#x4E2A;&#x90E8;&#x5206;&#x3002;&#x6700;&#x7EC8;&#x7684; state &#x5B8C;&#x5168;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x7531;
userReducer &#x548C; itemsReducer &#x8FD4;&#x56DE;&#x7684;&#x90E8;&#x5206; state &#x5171;&#x540C;&#x7EC4;&#x6210;&#x3002;
{
   user: {},  {} is the slice returned by our userReducer
   items: []  [] is the slice returned by our itemsReducer
}</p>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x4E3A;&#x6BCF;&#x4E2A; reducer &#x521D;&#x59CB;&#x5316;&#x4E86;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x503C;&#xFF08;userReducer &#x7684;&#x662F;&#x7A7A;&#x5BF9;&#x8C61; {} &#xFF0C;itemsReducer &#x7684;&#x662F;&#x7A7A;&#x6570;
&#x7EC4; [] &#xFF09;,&#x6240;&#x4EE5;&#x5728;&#x6700;&#x7EC8; Redux &#x7684; state &#x4E2D;&#x627E;&#x5230;&#x90A3;&#x4E9B;&#x503C;&#x5E76;&#x4E0D;&#x662F;&#x5DE7;&#x5408;&#x3002;</p>
<p>&#x73B0;&#x5728;&#xFF0C;&#x5173;&#x4E8E; reducer &#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x6E05;&#x695A;&#x7684;&#x7406;&#x89E3;&#x3002;&#x662F;&#x65F6;&#x5019;&#x53BB;&#x770B;&#x770B;&#x5F53; action &#x88AB;&#x5206;&#x53D1;&#xFF08;dispatch&#xFF09;&#x65F6;&#x4F1A;&#x5BF9;
Redux &#x7684; state &#x6709;&#x4EC0;&#x4E48;&#x5F71;&#x54CD;&#x3002;</p>
<h2 id="t66.dispatch-action">6.dispatch-action <a href="#t66.dispatch-action"> # </a></h2>
<p>&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#x6211;&#x4EEC;&#x7684;&#x5173;&#x6CE8;&#x70B9;&#x90FD;&#x662F;&#x7ED1;&#x5B9A;&#x6211;&#x4EEC;&#x7684; reducer(s)&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x8FD8;&#x672A; dispatch &#x4EFB;&#x4F55;&#x4E00;&#x4E2A; action&#x3002;
&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x7528;&#x5230;&#x4E0A;&#x4E00;&#x7AE0;&#x7684; reducer &#xFF0C;&#x5E76;&#x7528;&#x5B83;&#x4EEC;&#x5904;&#x7406;&#x4E00;&#x4E9B; action&#xFF1A;</p>
<p>var userReducer = function (state = {}, action) {
  console.log(&apos;userReducer was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
      case &apos;SET_NAME&apos;:
          return {
              ...state,
              name: action.name
          }
      default:
          return state;
  }
}
var itemsReducer = function (state = [], action) {
  console.log(&apos;itemsReducer was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
      case &apos;ADD_ITEM&apos;:
          return [
              ...state,
              action.item
          ]
      default:
          return state;
  }
}</p>
<p>import { createStore, combineReducers } from &apos;redux&apos;</p>
<p>var reducer = combineReducers({
  user: userReducer,
  items: itemsReducer
})
var store_0 = createStore(reducer)</p>
<p>console.log(&quot;\n&quot;, &apos;### It starts here&apos;)
console.log(&apos;store_0 state after initialization:&apos;, store_0.getState())
&#x8F93;&#x51FA;&#xFF1A;
store_0 state after initialization: { user: {}, items: [] }</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x6765; dispatch &#x6211;&#x4EEC;&#x7684;&#x7B2C;&#x4E00;&#x4E2A; action... &#x8BB0;&#x4F4F;&#x5728; &apos;simple-action-creator.js&apos; &#x4E2D;&#x6240;&#x63D0;&#x5230;&#x7684;&#xFF1A;
   &quot;&#x4E3A;&#x4E86; dispatch &#x4E00;&#x4E2A; action&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;... &#x4E00;&#x4E2A; dispatch &#x51FD;&#x6570;&#x3002;&quot; Captain obvious</p>
<p>&#x6211;&#x4EEC;&#x6240;&#x770B;&#x5230;&#x7684; dispatch &#x51FD;&#x6570;&#xFF0C;&#x662F; Redux &#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4F1A;&#x5C06; action &#x4F20;&#x9012;
&#x7ED9;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A; reducer&#xFF01;disparch &#x51FD;&#x6570;&#x672C;&#x8D28;&#x4E0A;&#x662F; Redux
&#x7684;&#x5B9E;&#x4F8B;&#x5C5E;&#x6027; &quot;dispatch&quot;</p>
<p>&#x7B80;&#x5355;&#x5730;&#x8C03;&#x7528;&#x4E00;&#x4E0B;&#xFF0C;&#x53BB; dispatch &#x4E00;&#x4E2A; action&#xFF1A;</p>
<p>store_0.dispatch({
  type: &apos;AN_ACTION&apos;
})
&#x8F93;&#x51FA;&#xFF1A;
userReducer was called with state {} and action { type: &apos;AN_ACTION&apos; }
itemsReducer was called with state [] and action { type: &apos;AN_ACTION&apos; }</p>
<p>&#x6BCF;&#x4E00;&#x4E2A; reducer &#x90FD;&#x6709;&#x6548;&#x5730;&#x88AB;&#x8C03;&#x7528;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x4E00;&#x4E2A; action type &#x662F; reducer &#x9700;&#x8981;&#x7684;&#xFF0C;
&#x56E0;&#x6B64; state &#x662F;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#xFF1A;</p>
<p>console.log(&apos;store_0 state after action AN_ACTION:&apos;, store_0.getState())
&#x8F93;&#x51FA;&#xFF1A;store_0 state after action AN_ACTION: { user: {}, items: [] }</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x7B49;&#x4E00;&#x4E0B;&#xFF01;&#x6211;&#x4EEC;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A; action creator &#x53BB;&#x53D1;&#x9001;&#x4E00;&#x4E2A; action&#xFF1F;&#x6211;&#x4EEC;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;
&#x7528;&#x4E00;&#x4E2A; actionCreator&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x5B83;&#x53EA;&#x662F;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; action&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5B83;&#x4E0D;&#x4F1A;&#x643A;&#x5E26;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;
&#x5230;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x3002;&#x4F46;&#x4E3A;&#x4E86;&#x9762;&#x5BF9;&#x672A;&#x6765;&#x9047;&#x5230;&#x7684;&#x56F0;&#x96BE;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4EE5;&#x6B63;&#x786E;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;
&#x5373;&#x4EE5; flux &#x7406;&#x8BBA;&#x53BB;&#x505A;&#x5427;&#x3002;&#x8BA9;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A; action creator &#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684; action&#xFF1A;</p>
<p>var setNameActionCreator = function (name) {
  return {
      type: &apos;SET_NAME&apos;,
      name: name
  }
}</p>
<p>store_0.dispatch(setNameActionCreator(&apos;bob&apos;))
&#x8F93;&#x51FA;&#xFF1A;
userReducer was called with state {} and action { type: &apos;SET_NAME&apos;, name: &apos;bob&apos; }
itemsReducer was called with state [] and action { type: &apos;SET_NAME&apos;, name: &apos;bob&apos; }</p>
<p>console.log(&apos;store_0 state after action SET_NAME:&apos;, store_0.getState())
&#x8F93;&#x51FA;&#xFF1A;
store_0 state after action SET_NAME: { user: { name: &apos;bob&apos; }, items: [] }</p>
<p>&#x5728;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A; action &#x5E76;&#x4E14;&#x7528;&#x5B83;&#x6539;&#x53D8;&#x4E86; state&#xFF01;</p>
<p>&#x4F46;&#x662F;&#x8FD9;&#x4F3C;&#x4E4E;&#x592A;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x4E0D;&#x8DB3;&#x4EE5;&#x5145;&#x5F53;&#x4E00;&#x4E2A;&#x771F;&#x5B9E;&#x7684;&#x7528;&#x4F8B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;
&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x5728; dispatch action &#x4E4B;&#x524D;&#x505A;&#x4E00;&#x4E9B;&#x5F02;&#x6B65;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x5462;&#xFF1F;
&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4E0B;&#x4E00;&#x7AE0;&#x8282; &quot;dispatch-async-action.js&quot; &#x4E2D;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;</p>
<p>&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x6D41;&#x7A0B;
ActionCreator -&gt; Action -&gt; dispatcher -&gt; reducer</p>
<h2 id="t77.dispatch-async-action-1.js">7.dispatch-async-action-1.js <a href="#t77.dispatch-async-action-1.js"> # </a></h2>
<p>&#x5728;&#x4E0A;&#x8282;&#x6559;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;&#x5982;&#x4F55;&#x5206;&#x53D1; action &#x4EE5;&#x53CA;&#x8FD9;&#x4E9B; action &#x5982;&#x4F55;&#x901A;&#x8FC7; reducer &#x51FD;&#x6570;&#x4FEE;&#x6539;&#x5E94;&#x7528;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8003;&#x8651;&#x4E86;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x540C;&#x6B65; action&#xFF0C;&#x51C6;&#x786E;&#x5730;&#x8BF4;&#x662F;&#x540C;&#x6B65; action creator&#xFF0C;&#x5B83;&#x540C;&#x6B65;&#x5730;&#x521B;&#x5EFA; action&#xFF0C;
&#x4E5F;&#x5C31;&#x662F;&#x5F53; action creator &#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;action &#x4F1A;&#x88AB;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x8BBE;&#x60F3;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5F02;&#x6B65;&#x573A;&#x666F;&#xFF1A;
1&#xFF09;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x300E;Say Hi in 2 seconds&#x300F;&#x6309;&#x94AE;
2&#xFF09;&#x5F53;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x6309;&#x94AE;&#x300E;A&#x300F;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7ECF;&#x8FC7;&#x4E24;&#x79D2;&#xFF0C;&#x89C6;&#x56FE;&#x663E;&#x793A;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x300E;Hi&#x300F;
3&#xFF09;&#x4E24;&#x79D2;&#x8FC7;&#x53BB;&#x4E4B;&#x540E;&#xFF0C;&#x66F4;&#x65B0;&#x89C6;&#x56FE;&#xFF0C;&#x663E;&#x793A;&#x6D88;&#x606F;&#x300E;Hi&#x300F;</p>
<p>&#x5F53;&#x7136;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x662F;&#x5E94;&#x7528;&#x7684;&#x72B6;&#x6001;&#x4E4B;&#x4E00;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5FC5;&#x7136;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x4E8E; Redux store&#x3002;
&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7684;&#x7ED3;&#x679C;&#x662F;&#xFF0C;&#x5728;&#x8C03;&#x7528; action creator &#x7684;&#x4E24;&#x79D2;&#x4E4B;&#x540E;&#x624D;&#x628A;&#x6D88;&#x606F;&#x5B58;&#x5165; store&#xFF08;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x7ACB;&#x5373;&#x66F4;&#x65B0;&#x72B6;&#x6001;&#xFF0C;
&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x7ACB;&#x5373;&#x89E6;&#x53D1;&#x6240;&#x6709;&#x76D1;&#x542C;&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x7684;&#x8BA2;&#x9605;&#x8005; &#x2014;&#x2014; &#x4F8B;&#x5982;&#x89C6;&#x56FE;&#xFF0C;&#x5BFC;&#x81F4;&#x6D88;&#x606F;&#x65E9;&#x4E8E;&#x4E24;&#x79D2;&#x663E;&#x793A;&#xFF09;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6309;&#x7167;&#x76EE;&#x524D;&#x8C03;&#x7528; action creator &#x7684;&#x65B9;&#x5F0F;...</p>
<p>import { createStore, combineReducers } from &apos;redux&apos;</p>
<p>var reducer = combineReducers({
  speaker: function (state = {}, action) {
      console.log(&apos;speaker was called with state&apos;, state, &apos;and action&apos;, action)</p>
<pre><code>  switch (action.type) {
      case &apos;SAY&apos;:
          return {
              ...state,
              message: action.message
          }
      default:
          return state;
  }
</code></pre><p>  }
})
var store_0 = createStore(reducer)</p>
<p>var sayActionCreator = function (message) {
  return {
      type: &apos;SAY&apos;,
      message
  }
}</p>
<p>console.log(&quot;\n&quot;, &apos;Running our normal action creator:&apos;, &quot;\n&quot;)</p>
<p>console.log(new Date());
store_0.dispatch(sayActionCreator(&apos;Hi&apos;))</p>
<p>console.log(new Date());
console.log(&apos;store_0 state after action SAY:&apos;, store_0.getState())</p>
<p>&#x8F93;&#x51FA;&#xFF08;&#x5FFD;&#x7565;&#x521D;&#x59CB;&#x8F93;&#x51FA;&#xFF09;&#xFF1A;
   Sun Aug 02 2015 01:03:05 GMT+0200 (CEST)
   speaker was called with state {} and action { type: &apos;SAY&apos;, message: &apos;Hi&apos; }
   Sun Aug 02 2015 01:03:05 GMT+0200 (CEST)
   store_0 state after action SAY: { speaker: { message: &apos;Hi&apos; } }</p>
<p>... &#x7ED3;&#x679C; store &#x88AB;&#x7ACB;&#x5373;&#x66F4;&#x65B0;&#x4E86;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x5E94;&#x8BE5;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>var asyncSayActionCreator_0 = function (message) {
  setTimeout(function () {
      return {
          type: &apos;SAY&apos;,
          message
      }
  }, 2000)
}</p>
<p>&#x4F46;&#x662F;&#x8FD9;&#x6837; action creator &#x8FD4;&#x56DE;&#x7684;&#x4E0D;&#x662F; action &#x800C;&#x662F; undefined&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x671F;&#x671B;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x8BC0;&#x7A8D;&#xFF1A;&#x4E0D;&#x8FD4;&#x56DE; action&#xFF0C;&#x800C;&#x662F;&#x8FD4;&#x56DE; function&#x3002;&#x8FD9;&#x4E2A; function &#x4F1A;&#x5728;&#x5408;&#x9002;&#x7684;&#x65F6;&#x673A;&#x5206;&#x53D1; action&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;
&#x8FD9;&#x4E2A; function &#x80FD;&#x591F;&#x5206;&#x53D1; action&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5411;&#x5B83;&#x4F20;&#x5165; dispatch &#x51FD;&#x6570;&#x3002;&#x4E8E;&#x662F;&#x4EE3;&#x7801;&#x7C7B;&#x4F3C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>var asyncSayActionCreator_1 = function (message) {
  return function (dispatch) {
      setTimeout(function () {
          dispatch({
              type: &apos;SAY&apos;,
              message
          })
      }, 2000)
  }
}</p>
<p>&#x4F60;&#x53EF;&#x80FD;&#x518D;&#x6B21;&#x6CE8;&#x610F;&#x5230; action creator &#x8FD4;&#x56DE;&#x7684;&#x4E0D;&#x662F; action &#x800C;&#x662F; function&#x3002;
&#x6240;&#x4EE5; reducer &#x51FD;&#x6570;&#x5F88;&#x53EF;&#x80FD;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x5904;&#x7406;&#x8FD9;&#x6837;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x800C;&#x4F60;&#x4E5F;&#x5E76;&#x4E0D;&#x6E05;&#x695A;&#x662F;&#x5426;&#x53EF;&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x518D;&#x505A;&#x5C1D;&#x8BD5;&#xFF0C;&#x4E00;&#x63A2;&#x7A76;&#x7ADF;&#x3002;</p>
<h2 id="t88.dispatch-async-action-2">8.dispatch-async-action-2 <a href="#t88.dispatch-async-action-2"> # </a></h2>
<p>&#x8FD0;&#x884C;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5728; dispatch-async-action-1.js &#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5F02;&#x6B65; action creator&#xFF1A;</p>
<p>import { createStore, combineReducers } from &apos;redux&apos;</p>
<p>var reducer = combineReducers({
  speaker: function (state = {}, action) {
      console.log(&apos;speaker was called with state&apos;, state, &apos;and action&apos;, action)</p>
<pre><code>  switch (action.type) {
      case &apos;SAY&apos;:
          return {
              ...state,
              message: action.message
          }
      default:
          return state;
  }
</code></pre><p>  }
})
var store_0 = createStore(reducer)</p>
<p>var asyncSayActionCreator_1 = function (message) {
  return function (dispatch) {
      setTimeout(function () {
          dispatch({
              type: &apos;SAY&apos;,
              message
          })
      }, 2000)
  }
}</p>
<p>console.log(&quot;\n&quot;, &apos;Running our async action creator:&apos;, &quot;\n&quot;)
store_0.dispatch(asyncSayActionCreator_1(&apos;Hi&apos;))</p>
<p>&#x8F93;&#x51FA;&#xFF1A;
   ...
   /Users/classtar/Codes/redux-tutorial/node_modules/redux/node_modules/invariant/invariant.js:51
       throw error;
             ^
   Error: Invariant Violation: Actions must be plain objects. Use custom middleware for async actions.
   ...</p>
<p>&#x6211;&#x4EEC;&#x6240;&#x8BBE;&#x8BA1;&#x7684; function &#x4F3C;&#x4E4E;&#x6CA1;&#x6709;&#x8FDB;&#x5165; reducer &#x51FD;&#x6570;&#x3002;&#x4F46;&#x662F; Redux &#x7ED9;&#x51FA;&#x4E86;&#x6E29;&#x99A8;&#x63D0;&#x793A;&#xFF1A;&#x81EA;&#x5B9A;&#x4E49;&#x4E2D;&#x95F4;&#x4EF6;&#xFF08;middleware&#xFF09;&#x5B9E;&#x73B0;&#x5F02;&#x6B65; action&#x3002;
&#x770B;&#x6765;&#x6211;&#x4EEC;&#x7684;&#x65B9;&#x5411;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x53EF;&#x4E2D;&#x95F4;&#x4EF6;&#xFF08;middleware&#xFF09;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>
<p>&#x6211;&#x5411;&#x4F60;&#x4FDD;&#x8BC1; action creator asyncSayActionCreator_1 &#x4E0D;&#x4EC5;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x641E;&#x6E05;&#x695A; middleware &#x7684;&#x6982;&#x5FF5;&#x5E76;&#x638C;&#x63E1;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;
&#x8FD9;&#x4E2A;&#x5F02;&#x6B65; action creator &#x5C31;&#x4F1A;&#x6309;&#x7167;&#x6211;&#x4EEC;&#x6240;&#x8BBE;&#x60F3;&#x7684;&#x7ED3;&#x679C;&#x6267;&#x884C;&#x7684;&#x3002;</p>
<h2 id="t99.middleware">9.middleware <a href="#t99.middleware"> # </a></h2>
<p>We left dispatch-async-action-2.js with a new concept: &quot;middleware&quot;. Somehow middleware should help us
to solve async action handling. So what exactly is middleware?</p>
<p>Generally speaking middleware is something that goes between parts A and B of an application to
transform what A sends before passing it to B. So instead of having:
A -----&gt; B
we end up having
A ---&gt; middleware 1 ---&gt; middleware 2 ---&gt; middleware 3 --&gt; ... ---&gt; B</p>
<p>How could middleware help us in the Redux context? Well it seems that the function that we are
returning from our async action creator cannot be handled natively by Redux but if we had a
middleware between our action creator and our reducers, we could transform this function into something
that suits Redux:</p>
<p>action ---&gt; dispatcher ---&gt; middleware 1 ---&gt; middleware 2 ---&gt; reducers</p>
<p>Our middleware will be called each time an action (or whatever else, like a function in our
async action creator case) is dispatched and it should be able to help our action creator
dispatch the real action when it wants to (or do nothing - this is a totally valid and
sometimes desired behavior).</p>
<p>In Redux, middleware are functions that must conform to a very specific signature and follow
a strict structure:
/<em>
  var anyMiddleware = function ({ dispatch, getState }) {
      return function(next) {
          return function (action) {
               your middleware-specific code goes here
          }
      }
  }
</em>/</p>
<p>As you can see above, a middleware is made of 3 nested functions (that will get called sequentially):
1) The first level provide the dispatch function and a getState function (if your
   middleware or your action creator needs to read data from state) to the 2 other levels
2) The second level provide the next function that will allow you to explicitly hand over
   your transformed input to the next middleware or to Redux (so that Redux can finally call all reducers).
3) the third level provides the action received from the previous middleware or from your dispatch
   and can either trigger the next middleware (to let the action continue to flow) or process
   the action in any appropriate way.</p>
<p>Those of you who are trained to functional programming may have recognized above an opportunity
to apply a functional pattern: currying (if you aren&apos;t, don&apos;t worry, skipping the next 10 lines
won&apos;t affect your redux understanding). Using currying, you could simplify the above function like that:
/<em>
   &quot;curry&quot; may come any functional programming library (lodash, ramda, etc.)
  var thunkMiddleware = curry(
      ({dispatch, getState}, next, action) =&gt; (
           your middleware-specific code goes here
      )
  );
</em>/</p>
<p>The middleware we have to build for our async action creator is called a thunk middleware and
its code is provided here: https:github.com/gaearon/redux-thunk.
Here is what it looks like (with function body translated to es5 for readability):</p>
<p>var thunkMiddleware = function ({ dispatch, getState }) {
   console.log(&apos;Enter thunkMiddleware&apos;);
  return function(next) {
       console.log(&apos;Function &quot;next&quot; provided:&apos;, next);
      return function (action) {
           console.log(&apos;Handling action:&apos;, action);
          return typeof action === &apos;function&apos; ?
              action(dispatch, getState) :
              next(action)
      }
  }
}</p>
<p>To tell Redux that we have one or more middlewares, we must use one of Redux&apos;s
helper functions: applyMiddleware.</p>
<p>&quot;applyMiddleware&quot; takes all your middlewares as parameters and returns a function to be called
with Redux createStore. When this last function is invoked, it will produce &quot;a higher-order
store that applies middleware to a store&apos;s dispatch&quot;.
(from https:github.com/rackt/redux/blob/v1.0.0-rc/src/utils/applyMiddleware.js)</p>
<p>Here is how you would integrate a middleware to your Redux store:</p>
<p>import { createStore, combineReducers, applyMiddleware } from &apos;redux&apos;</p>
<p>const finalCreateStore = applyMiddleware(thunkMiddleware)(createStore)
For multiple middlewares, write: applyMiddleware(middleware1, middleware2, ...)(createStore)</p>
<p>var reducer = combineReducers({
  speaker: function (state = {}, action) {
      console.log(&apos;speaker was called with state&apos;, state, &apos;and action&apos;, action)</p>
<pre><code>  switch (action.type) {
      case &apos;SAY&apos;:
          return {
              ...state,
              message: action.message
          }
      default:
          return state
  }
</code></pre><p>  }
})</p>
<p>const store_0 = finalCreateStore(reducer)
Output:
   speaker was called with state {} and action { type: &apos;@@redux/INIT&apos; }
   speaker was called with state {} and action { type: &apos;@@redux/PROBE_UNKNOWN_ACTION_s.b.4.z.a.x.a.j.o.r&apos; }
   speaker was called with state {} and action { type: &apos;@@redux/INIT&apos; }</p>
<p>Now that we have our middleware-ready store instance, let&apos;s try again to dispatch our async action:</p>
<p>var asyncSayActionCreator_1 = function (message) {
  return function (dispatch) {
      setTimeout(function () {
          console.log(new Date(), &apos;Dispatch action now:&apos;)
          dispatch({
              type: &apos;SAY&apos;,
              message
          })
      }, 2000)
  }
}</p>
<p>console.log(&quot;\n&quot;, new Date(), &apos;Running our async action creator:&apos;, &quot;\n&quot;)</p>
<p>store_0.dispatch(asyncSayActionCreator_1(&apos;Hi&apos;))
Output:
   Mon Aug 03 2015 00:01:20 GMT+0200 (CEST) Running our async action creator:
   Mon Aug 03 2015 00:01:22 GMT+0200 (CEST) &apos;Dispatch action now:&apos;
   speaker was called with state {} and action { type: &apos;SAY&apos;, message: &apos;Hi&apos; }</p>
<p>Our action is correctly dispatched 2 seconds after our call the async action creator!</p>
<p>Just for your curiosity, here is how a middleware to log all actions that are dispatched, would
look like:</p>
<p>function logMiddleware ({ dispatch, getState }) {
  return function(next) {
      return function (action) {
          console.log(&apos;logMiddleware action received:&apos;, action)
          return next(action)
      }
  }
}</p>
<p>Same below for a middleware to discard all actions that goes through (not very useful as is
but with a bit of more logic it could selectively discard a few actions while passing others
to next middleware or Redux):
function discardMiddleware ({ dispatch, getState }) {
  return function(next) {
      return function (action) {
          console.log(&apos;discardMiddleware action received:&apos;, action)
      }
  }
}</p>
<p>Try to modify finalCreateStore call above by using the logMiddleware and / or the discardMiddleware
and see what happens...
For example, using:
   const finalCreateStore = applyMiddleware(discardMiddleware, thunkMiddleware)(createStore)
should make your actions never reach your thunkMiddleware and even less your reducers.</p>
<p>See http:rackt.org/redux/docs/introduction/Ecosystem.html, section Middlewares, to
see other middleware examples.</p>
<p>Let&apos;s sum up what we&apos;ve learned so far:
1) We know how to write actions and action creators
2) We know how to dispatch our actions
3) We know how to handle custom actions like asynchronous actions thanks to middlewares</p>
<p>The only missing piece to close the loop of Flux application is to be notified about
state updates to be able to react to them (by re-rendering our components for example).</p>
<p>So how do we subscribe to our Redux store updates?</p>
<h2 id="t1010.state-subscriber">10.state-subscriber <a href="#t1010.state-subscriber"> # </a></h2>
<p>We&apos;re close to having a complete Flux loop but we still miss one critical part:</p>
<hr>
<p>|         |    | Change  |     |   React   |
|  Store  |----&#x25B6; events  |-----&#x25B6;   Views   |
|<strong><strong>_</strong></strong>|    |<strong><strong>_</strong></strong>|     |<strong><strong>___</strong></strong>|</p>
<p>Without it, we cannot update our views when the store changes.</p>
<p>Fortunately, there is a very simple way to &quot;watch&quot; over our Redux&apos;s store updates:</p>
<p>/<em>
  store.subscribe(function() {
       retrieve latest store state here
       Ex:
      console.log(store.getState());
  })
</em>/</p>
<p>Yeah... So simple that it almost makes us believe in Santa Claus again.</p>
<p>Let&apos;s try this out:</p>
<p>import { createStore, combineReducers } from &apos;redux&apos;</p>
<p>var itemsReducer = function (state = [], action) {
  console.log(&apos;itemsReducer was called with state&apos;, state, &apos;and action&apos;, action)</p>
<p>  switch (action.type) {
      case &apos;ADD_ITEM&apos;:
          return [
              ...state,
              action.item
          ]
      default:
          return state;
  }
}</p>
<p>var reducer = combineReducers({ items: itemsReducer })
var store_0 = createStore(reducer)</p>
<p>store_0.subscribe(function() {
  console.log(&apos;store_0 has been updated. Latest store state:&apos;, store_0.getState());
   Update your views here
})</p>
<p>var addItemActionCreator = function (item) {
  return {
      type: &apos;ADD_ITEM&apos;,
      item: item
  }
}</p>
<p>store_0.dispatch(addItemActionCreator({ id: 1234, description: &apos;anything&apos; }))</p>
<p>Output:
   ...
   store_0 has been updated. Latest store state: { items: [ { id: 1234, description: &apos;anything&apos; } ] }</p>
<p>Our subscribe callback is correctly called and our store now contains the new item that we added.</p>
<p>Theoretically speaking we could stop here. Our Flux loop is closed, we understood all concepts that make
Flux and we saw that it is not that much of a mystery. But to be honest, there is still a lot to talk
about and a few things in the last example were intentionally left aside to keep the simplest form of this
last Flux concept:</p>
<ul>
<li>Our subscriber callback did not receive the state as a parameter, why?</li>
<li>Since we did not receive our new state, we were bound to exploit our closured store (store_0) so this
 solution is not acceptable in a real multi-modules application...</li>
<li>How do we actually update our views?</li>
<li>How do we unsubscribe from store updates?</li>
<li>More generally speaking, how should we integrate Redux with React?</li>
</ul>
<p>We&apos;re now entering a more &quot;Redux inside React&quot; specific domain.</p>
<p>It is very important to understand that Redux is by no means bound to React. It is really a
&quot;Predictable state container for JavaScript apps&quot; and you can use it in many ways, a React
application just being one of them.</p>
<p>In that perspective we would be a bit lost if it wasn&apos;t for react-redux (https:github.com/rackt/react-redux).
Previously integrated inside Redux (before 1.0.0), this repository holds all the bindings we need to simplify
our life when using Redux inside React.</p>
<p>Back to our &quot;subscribe&quot; case... Why exactly do we have this subscribe function that seems so simple but at
the same time also seems to not provide enough features?</p>
<p>Its simplicity is actually its power! Redux, with its current minimalist API (including &quot;subscribe&quot;) is
highly extensible and this allows developers to build some crazy products like the Redux DevTools
(https:github.com/gaearon/redux-devtools).</p>
<p>But in the end we still need a &quot;better&quot; API to subscribe to our store changes. That&apos;s exactly what react-redux
brings us: an API that will allow us to seamlessly fill the gap between the raw Redux subscribing mechanism
and our developer expectations. In the end, you won&apos;t need to use &quot;subscribe&quot; directly. Instead you will
use bindings such as &quot;provide&quot; or &quot;connect&quot; and those will hide from you the &quot;subscribe&quot; method.</p>
<p>So yeah, the &quot;subscribe&quot; method will still be used but it will be done through a higher order API that
handles access to redux state for you.</p>
<p>We&apos;ll now cover those bindings and show how simple it is to wire your components to Redux&apos;s state.</p>
<h2 id="t1111.Provider-and-connect&#xFF08;&#x5B9E;&#x6218;&#xFF09;">11.Provider-and-connect&#xFF08;&#x5B9E;&#x6218;&#xFF09; <a href="#t1111.Provider-and-connect&#xFF08;&#x5B9E;&#x6218;&#xFF09;"> # </a></h2>
<p>&#x8FD9;&#x5176;&#x5B9E;&#x662F;&#x6559;&#x7A0B;&#x7684;&#x6700;&#x540E;&#x4E00;&#x7AE0;&#xFF0C;&#x4E00;&#x8D77;&#x804A;&#x804A;&#x5982;&#x4F55;&#x628A; Redux &#x548C; React &#x7ED1;&#x5B9A;&#x5728;&#x4E00;&#x8D77;&#x3002;</p>
<p>&#x8981;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x3002;</p>
<p>&#x672C;&#x793A;&#x4F8B;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x548C;&#x6CE8;&#x91CA;&#x90FD;&#x5728; ./11_src/src/ &#x76EE;&#x5F55;&#x4E0B;&#x3002;</p>
<p>&#x5F53;&#x4F60;&#x8BFB;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x8BDD;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C; 11_src/src/server.js&#x3002;</p>
<p>&#x5F00;&#x53D1;&#x4E00;&#x4E2A; React &#x5E94;&#x7528;&#x548C;&#x670D;&#x52A1;&#x5668;&#x6765;&#x8BA9;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x7528;&#x5230;&#xFF1A;</p>
<ul>
<li>&#x7528; node HTTP(https:nodejs.org/api/http.html) &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x7528; Webpack &#x53BB;&#x6253;&#x5305;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#xFF0C;</li>
<li>&#x795E;&#x5947;&#x7684; Webpack Dev Server (http:webpack.github.io/docs/webpack-dev-server.html)
&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x7684; node &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E76;&#x76D1;&#x542C; JS &#x6539;&#x53D8;&#x81EA;&#x52A8;&#x7F16;&#x8BD1;</li>
<li>&#x8D85;&#x68D2;&#x7684; React Hot Loader http:gaearon.github.io/react-hot-loader/ (Dan Abramov
&#x5F00;&#x53D1;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5F88;&#x68D2;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6CA1;&#x9519;&#xFF0C;&#x4ED6;&#x5C31;&#x662F; Redux &#x7684;&#x4F5C;&#x8005;) &#xFF0C;&#x63D0;&#x4F9B;&#x975E;&#x5E38;&#x68D2;&#x7684;
DX (&#x5F00;&#x53D1;&#x4F53;&#x9A8C;) &#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x7F16;&#x8F91;&#x5668;&#x4E2D;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;
&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x53EF;&#x4EE5;&#x70ED;&#x52A0;&#x8F7D;&#x6765;&#x663E;&#x793A;&#x6548;&#x679C;&#x3002;</li>
</ul>
<p>&#x63D0;&#x9192;&#x4E00;&#x4E0B; React &#x5F00;&#x53D1;&#x8005;&#xFF1A;&#x672C;&#x5E94;&#x7528;&#x662F;&#x57FA;&#x4E8E; React 0.14 &#x6784;&#x5EFA;&#x7684;</p>
<p>&#x6211;&#x4E0D;&#x60F3;&#x5728;&#x8FD9;&#x91CC;&#x8BE6;&#x7EC6;&#x5730;&#x89E3;&#x91CA;&#x5982;&#x4F55;&#x8BBE;&#x7F6E; Webpack Dev Server &#x548C; React Hot Loader&#xFF0C;
&#x56E0;&#x4E3A;&#x5728; React Hot Loader &#x7684;&#x6587;&#x6863;&#x4E2D;&#x5DF2;&#x7ECF;&#x8BF4;&#x7684;&#x5F88;&#x597D;&#x4E86;&#x3002;
import webpackDevServer from &apos;./11_src/src/webpack-dev-server&apos;
&#x6211;&#x4EEC;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x7684;&#x4E3B;&#x8981;&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x90FD;&#x662F;&#x6765;&#x81EA;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;
import server from &apos;./11_src/src/server&apos;</p>
<p>&#x5982;&#x679C; 5050 &#x7AEF;&#x53E3;&#x53F7;&#x5DF2;&#x7ECF;&#x88AB;&#x5360;&#x7528;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4FEE;&#x6539;&#x4E0B;&#x9762;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x3002;
&#x5982;&#x679C;&#x7AEF;&#x53E3;&#x53F7;&#x662F; X&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; X &#x4F5C;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x7528; X+1 &#x4F5C;&#x4E3A; webpack-dev-server &#x7684;&#x7AEF;&#x53E3;&#x53F7;
const port = 5050</p>
<p>&#x542F;&#x52A8; webpack dev server...
webpackDevServer.listen(port)
... &#x8FD8;&#x6709;&#x4E3B;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x3002;
server.listen(port)</p>
<p>console.log(<code>Server is listening on http:127.0.0.1:${port}</code>)</p>
<p><strong>&#x8F6C;&#x5230; 11_src/src/server.js...</strong></p>
<h2 id="t1212.&#x7ED3;&#x8BED;">12.&#x7ED3;&#x8BED; <a href="#t1212.&#x7ED3;&#x8BED;"> # </a></h2>
<p>There is actually more to Redux and react-redux than what we showed you with this tutorial. For example,
concerning Redux, you may be interested in bindActionCreators (to produce a hash of action creators
already bound to dispatch - http:rackt.org/redux/docs/api/bindActionCreators.html).</p>
<p>We hope we&apos;ve given you the keys to better understand Flux and to see more clearly
how Flux implementations differ from one another--especially how Redux stands out ;).</p>
<p>Where to go from here?</p>
<p>The official Redux documentation is really awesome and exhaustive so you should not hesitate to
refer to it from now on: http:rackt.org/redux/index.html</p>
<p>Have fun with React and Redux!</p>
<h2 id="t13&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599; <a href="#t13&#x53C2;&#x8003;&#x8D44;&#x6599;"> # </a></h2>
<h3 id="t14Flux">Flux <a href="#t14Flux"> # </a></h3>
<ul>
<li><a href="https:github.com/react-guide/flux-cn">Flux</a></li>
<li><a href="http:reactjs.cn/react/docs/flux-overview.html">Flux&#x5E94;&#x7528;&#x67B6;&#x6784;</a></li>
<li><a href="http:facebook.github.io/flux/docs/overview.html#content">flux docs</a><h3 id="t15Redux">Redux <a href="#t15Redux"> # </a></h3>
</li>
<li><a href="http:camsong.github.io/redux-in-chinese/index.html">Redux &#x4E2D;&#x6587;&#x6587;&#x6863;</a></li>
<li><a href="https:github.com/react-guide/redux-tutorial-cn#redux-tutorial">redux-tutorial-cn</a></li>
<li><a href="https:github.com/reactjs/redux">redux on github</a></li>
<li><a href="https:github.com/happypoulp/redux-tutorial">redux-tutorial</a></li>
</ul>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    </div>

</div>


</body>
</html>
